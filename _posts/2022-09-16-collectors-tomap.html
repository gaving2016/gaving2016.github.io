---
layout: post
title: Collectors.toMap
date: 2022-09-16 10:08:34.000000000 +08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Java
tags: []
meta:
  _edit_last: '1'
  blocksy_post_meta_options: a:1:{s:17:"styles_descriptor";a:3:{s:6:"styles";a:3:{s:7:"desktop";s:0:"";s:6:"tablet";s:0:"";s:6:"mobile";s:0:"";}s:12:"google_fonts";a:0:{}s:7:"version";i:5;}}
author:
  login: gavin
  email: 519077334@qq.com
  display_name: gavin
  first_name: ''
  last_name: ''
permalink: "/index.php/2022/09/16/collectors-tomap/"
---
<div>
<h3><b>1.使用规则：</b></h3>
<p>toMap(Function, Function) 返回一个 Collector，它将元素累积到一个 Map中，其键和值是将提供的映射函数应用于输入元素的结果。</p>
<p>如果映射的键包含重复项，则在执行收集操作时会抛出IllegalStateException。如果映射的键可能有重复项，请改用  toMap(Function, Function, BinaryOperator)。</p>
<h3><b>2.我们测试一下，首先新建一个Sdudent 类，三个属性分别是id，name，group</b></h3>
<p>然后构造一个List</p>
<p>List&lt;Student&gt; list = new ArrayList&lt;&gt;();</p>
<p>for (int i = 1; i &lt; 4; i++) {</p>
<p>list.add(new Student(i+"","学生"+i));</p>
<p>}</p>
<p><b>1. 将list转成以id为key的map，value是id对应的Sudent对象： </b></p>
<p>Map&lt;String, Student&gt; map = list.stream().collect(Collectors.toMap(Student::getId, Function.identity()));</p>
<p><b>2.假如id存在重复值，则会报错Duplicate key xxx, 解决方案是：</b></p>
<p>只取后一个key及value：</p>
<p>Map&lt;String, Student&gt; map = list.stream().collect(Collectors.toMap(Student::getId,Function.identity(),(oldValue,newValue) -&gt; newValue))</p>
<p>只取前一个key及value：</p>
<p>Map&lt;String, Student&gt; map = list.stream().collect(Collectors.toMap(Student::getId,Function.identity(),(oldValue,newValue) -&gt; oldValue))</p>
<p><b>3.想获得一个id和name对应的Map&lt;String, String&gt; ：</b></p>
<p>Map&lt;String, String&gt; map = list.stream().collect(Collectors.toMap(Student::getId,Student::getName));</p>
<p><i><b>注意：name可以为空字符串但不能为null，否则会报空指针，解决方案：</b></i></p>
<p>Map&lt;String, String&gt; map = list.stream().collect(Collectors.toMap(Student::getId, e-&gt;e.getName()==null?"":e.getName()));</p>
<p><b><i>假如存在id重复，两个vaue可以这样映射到同一个id：</i></b></p>
<p>Map&lt;String, String&gt; map = list.stream().collect(Collectors.toMap(Student::getId,Student::getName,(e1,e2)-&gt;e1+","+e2));</p>
<p><b>4.把Student集合按照group分组到map中</b></p>
<p>Map&lt;String, List&lt;Student&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Student::getGroup));</p>
<p><b>5.过滤去重，两个List&lt;Student&gt; </b></p>
<p>List&lt;Student&gt; list1 = new ArrayList&lt;&gt;();</p>
<p>List&lt;Student&gt; list2= new ArrayList&lt;&gt;();</p>
<p>HashMap&lt;String, String&gt; hashMap = new HashMap&lt;&gt;();</p>
<p>for (int i = 1; i &lt; 4; i++) {</p>
<p>list1.add(new Student(i+"","学生"+i));</p>
<p>}</p>
<p>for (int i = 2; i &lt; 5; i++) {</p>
<p>list2.add(new Student(i+"","学生"+i));</p>
<p>}</p>
<p>Map&lt;String, Student&gt; map2 = list2.stream().collect(Collectors.toMap(Student::getId,Function.identity()));</p>
<p><b>//把List1和List2中id重复的Student对象的name取出来：</b></p>
<p>List&lt;String&gt; strings = list1.stream().map(Student::getId).filter(map2::containsKey).map(map2::get).map(Student::getName).collect(Collectors.toList());</p>
<p>System.out.println(strings);// 输出 [学生2, 学生3]</p>
</div>
